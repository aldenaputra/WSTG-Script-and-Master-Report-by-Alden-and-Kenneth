<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWASP WSTG Report - Detailed Session Management Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 2em;
            color: #333;
        }
        h1, h2, h3, h4 {
            color: #000;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }
        .section {
            margin-bottom: 2em;
            padding: 1em;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5em;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        pre {
            background-color: #f4f4f4;
            padding: 1em;
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: "Courier New", Courier, monospace;
            background-color: #eee;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .severity-critical { background-color: #ff4d4d; color: white; }
        .severity-high { background-color: #ff9933; }
        .severity-medium { background-color: #ffff66; }
        .severity-low { background-color: #99ff99; }
        .severity-info { background-color: #e6e6e6; }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .passed {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .failed {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .note {
            background-color: #e7f5fe;
            border-left: 4px solid #4dabf7;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <h1>Detailed Session Management Testing Report</h1>
    <p><strong>Target URL</strong>: http://localhost:8080</p>
    <p><strong>Date</strong>: 2025-08-04</p>

    <!-- OTG-SESS-001 -->
    <div class="section">
        <h2>OTG-SESS-001: Testing for Bypassing Session Management Schema</h2>
        
        <h3>Test Objective</h3>
        <p>This test checks if the application's session management can be bypassed through session ID prediction, manipulation, or accepting arbitrary session IDs. It verifies if session tokens are sufficiently random and unpredictable.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code>def analyze_cookie(cookie_value):
    """Analyze cookie for common vulnerabilities."""
    analysis = {"length": len(cookie_value)}
    
    # Check if cookie is predictable
    if cookie_value.isdigit():
        analysis["predictable"] = True
    elif len(set(cookie_value)) < 5:  # Low entropy
        analysis["predictable"] = True
    else:
        analysis["predictable"] = False
    
    # Check encoding
    if "%" in cookie_value:
        analysis["encoded"] = True
    else:
        analysis["encoded"] = False
    
    return analysis</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Login: <code>/login.php</code></li>
            <li>Profile: <code>/profile.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Obtain a valid session ID through normal login</li>
            <li>Analyze the session ID for predictability (length, character set, encoding)</li>
            <li>Attempt to modify parts of the session ID and check if it's accepted</li>
            <li>Generate random session IDs of similar length and check if they're accepted</li>
            <li>Check if session ID can be passed via URL parameter</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application and capture session cookie</li>
            <li>Modify last 4 characters of session ID and try accessing profile page</li>
            <li>Generate random session ID with same length and try accessing profile page</li>
            <li>Append session ID as URL parameter (<code>?session_id=...</code>) and try accessing profile page</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

    <!-- OTG-SESS-002 -->
    <div class="section">
        <h2>OTG-SESS-002: Testing for Cookies Attributes</h2>
        
        <h3>Test Objective</h3>
        <p>This test examines the security attributes of cookies (especially session cookies) including Secure, HttpOnly, SameSite flags, domain scope, and expiration policies. Proper cookie attributes are essential for preventing session hijacking.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code>def get_cookie_attributes(response, cookie_name):
    """Get security attributes of a cookie."""
    cookie = response.cookies.get(cookie_name)
    if not cookie:
        return None
    
    return {
        "secure": cookie.secure,
        "httponly": "HttpOnly" in str(cookie),
        "samesite": "None",
        "domain": cookie.domain,
        "path": cookie.path,
        "expires": cookie.expires
    }</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Login: <code>/login.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Perform login request and capture all cookies</li>
            <li>Inspect each cookie for security attributes</li>
            <li>Check for presence of Secure, HttpOnly, and SameSite flags</li>
            <li>Verify domain and path restrictions are properly set</li>
            <li>Check if session cookies have expiration dates (shouldn't)</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application while monitoring cookies in response</li>
            <li>Inspect <code>PHPSESSID</code> and <code>security</code> cookies</li>
            <li>Verify cookie attributes using browser developer tools or proxy</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result failed">
            <strong>Vulnerabilities Found:</strong>
            <ul>
                <li>Cookie PHPSESSID has weak SameSite policy: None</li>
                <li>Cookie PHPSESSID has overly broad domain: localhost.local</li>
                <li>Cookie security has weak SameSite policy: None</li>
                <li>Cookie security has overly broad domain: localhost.local</li>
            </ul>
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "cookies_analyzed": {
    "PHPSESSID": {
      "secure": false,
      "httponly": false,
      "samesite": "None",
      "domain": "localhost.local",
      "path": "/",
      "expires": null
    },
    "security": {
      "secure": false,
      "httponly": false,
      "samesite": "None",
      "domain": "localhost.local",
      "path": "/",
      "expires": null
    }
  }
}</pre>
        
        <h3>Recommendation</h3>
        <ul>
            <li>Set <code>Secure</code> flag to ensure cookies are only sent over HTTPS</li>
            <li>Set <code>HttpOnly</code> flag to prevent JavaScript access</li>
            <li>Set <code>SameSite</code> to <code>Lax</code> or <code>Strict</code> to prevent CSRF</li>
            <li>Restrict cookie domain to specific subdomains if possible</li>
        </ul>
    </div>

    <!-- OTG-SESS-003 -->
    <div class="section">
        <h2>OTG-SESS-003: Testing for Session Fixation</h2>
        
        <h3>Test Objective</h3>
        <p>This test checks if the application is vulnerable to session fixation attacks, where an attacker can force a user to use a predetermined session ID. The application should regenerate session IDs after login.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code># Step 1: Get session before login
response = http_request("GET", LOGIN_URL)
session_cookie = next((c for c in response.cookies if "session" in c.name.lower()), None)

# Step 2: Login with same session
cookies = {session_cookie.name: session_cookie.value}
login_response = http_request("POST", LOGIN_URL, data=credentials, cookies=cookies)

# Step 3: Check if session ID changed
session_id_after = login_response.cookies.get(session_cookie.name)</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Login: <code>/login.php</code></li>
            <li>Profile: <code>/profile.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Obtain a session ID before authentication</li>
            <li>Use this same session ID during authentication</li>
            <li>Check if the session ID remains the same after successful login</li>
            <li>Verify if the pre-authentication session becomes authenticated</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Visit login page and capture session cookie</li>
            <li>Submit login credentials while preserving the same session ID</li>
            <li>Check if session ID changes after successful login</li>
            <li>Attempt to access protected resources with original session ID</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found<br>
            <div class="note">
                Note: The test couldn't find a session cookie before login, which prevented complete testing.
            </div>
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "No session cookie found"
}</pre>
    </div>

    <!-- OTG-SESS-004 -->
    <div class="section">
        <h2>OTG-SESS-004: Testing for Exposed Session Variables</h2>
        
        <h3>Test Objective</h3>
        <p>This test checks if session-related variables are exposed in client-side code, URLs, or error messages, which could lead to session hijacking.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code>sensitive_patterns = [
    r'session["\']?[_:]?(id|token)\s*=\s*["\']?([^\s"\']+)',
    r'user["\']?[_:]?(id|token)\s*=\s*["\']?([^\s"\']+)',
    r'auth["\']?[_:]?(token|key)\s*=\s*["\']?([^\s"\']+)',
    r'<input [^>]*name=["\']?(session_?id|token)["\']? [^>]*value=["\']?([^\s"\']+)',
    r'data-?session=["\']?([^\s"\']+)',
    r'window\.session(?:Id|Token)\s*=\s*["\']?([^\s"\']+)'
]</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Profile: <code>/profile.php</code></li>
            <li>Dashboard: <code>/dashboard.php</code></li>
            <li>Account: <code>/account.php</code></li>
            <li>Settings: <code>/settings.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Access authenticated pages after login</li>
            <li>Search HTML source for session-related patterns</li>
            <li>Check URL parameters for session tokens</li>
            <li>Inspect JavaScript files and data attributes</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application</li>
            <li>Visit various authenticated pages</li>
            <li>View page source and search for session IDs/tokens</li>
            <li>Check browser developer tools for exposed session data</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

    <!-- OTG-SESS-005 -->
    <div class="section">
        <h2>OTG-SESS-005: Testing for Cross Site Request Forgery (CSRF)</h2>
        
        <h3>Test Objective</h3>
        <p>This test checks if the application is vulnerable to CSRF attacks by examining forms for anti-CSRF tokens and verifying if actions can be performed without them.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code># Check if form has CSRF protection
has_csrf = any('csrf' in key.lower() or 'token' in key.lower() for key in form_data.keys())

# Test without CSRF token if form should have one
if has_csrf:
    modified_data = {k: v for k, v in form_data.items() if 'csrf' not in k.lower() and 'token' not in k.lower()}
    response = http_request(form_method, form_action, data=modified_data, cookies=cookies)
    if response and "success" in response.text.lower():
        results["vulnerabilities"].append(f"CSRF vulnerability in form at {form_action}")</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Sensitive Action: <code>/change_email.php</code></li>
            <li>Other forms throughout the application</li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Identify all forms in the application</li>
            <li>Check for presence of CSRF tokens</li>
            <li>Submit forms without CSRF tokens</li>
            <li>Verify if actions succeed without proper tokens</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application</li>
            <li>Access sensitive action page (e.g., change email)</li>
            <li>Remove CSRF token from form submission</li>
            <li>Submit form and check if action succeeds</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

    <!-- OTG-SESS-006 -->
    <div class="section">
        <h2>OTG-SESS-006: Testing for Logout Functionality</h2>
        
        <h3>Test Objective</h3>
        <p>This test verifies if the application properly invalidates sessions during logout by checking if session cookies are cleared and if back-button navigation is properly handled.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code># Step 1: Perform logout
logout_response = http_request("GET", LOGOUT_URL, cookies=cookies)

# Step 2: Try to access protected page after logout
profile_response = http_request("GET", PROFILE_URL, cookies=cookies)

# Step 3: Test back button after logout
back_response = http_request("GET", PROFILE_URL, cookies=cookies)

# Step 4: Test session cookie removal
if logout_response.cookies.get(session_cookie_name):
    logout_cookie = logout_response.cookies.get(session_cookie_name)
    if logout_cookie and logout_cookie.expires and logout_cookie.expires < time.time():
        results["session_invalidation_tests"].append("Passed: Session cookie expired on logout")</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Logout: <code>/logout.php</code></li>
            <li>Profile: <code>/profile.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Login to application and capture session cookie</li>
            <li>Perform logout action</li>
            <li>Attempt to access protected page with old session cookie</li>
            <li>Check if session cookie is cleared or expired</li>
            <li>Test back-button behavior after logout</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application</li>
            <li>Click logout button</li>
            <li>Attempt to navigate back or access protected pages</li>
            <li>Check if session cookie still exists and is valid</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

    <!-- OTG-SESS-007 -->
    <div class="section">
        <h2>OTG-SESS-007: Test Session Timeout</h2>
        
        <h3>Test Objective</h3>
        <p>This test verifies if the application properly enforces session timeouts after a period of inactivity, preventing indefinite session validity.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code># Wait for session to expire (plus buffer time)
wait_time = SESSION_TIMEOUT + 60  # Session timeout + 1 minute
time.sleep(wait_time)

# Try to access protected page
response = http_request("GET", PROFILE_URL, cookies=cookies)

if response and "Welcome" in response.text:
    results["vulnerabilities"].append("Session timeout not enforced")</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Profile: <code>/profile.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Login to application and capture session cookie</li>
            <li>Wait for session timeout period plus buffer time</li>
            <li>Attempt to access protected page with old session cookie</li>
            <li>Verify if session is still valid</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application</li>
            <li>Wait for more than the session timeout period (15 minutes + buffer)</li>
            <li>Attempt to access protected page without new activity</li>
            <li>Check if session is still valid</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found<br>
            <div class="note">
                Note: The test couldn't verify timeout enforcement due to login failure.
            </div>
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

    <!-- OTG-SESS-008 -->
    <div class="section">
        <h2>OTG-SESS-008: Testing for Session Puzzling</h2>
        
        <h3>Test Objective</h3>
        <p>This test checks for session puzzling vulnerabilities where session variables set in one context are interpreted differently in another context, potentially leading to security issues.</p>
        
        <h3>Key Python Snippet</h3>
        <pre><code># Access a page that might store session variables
response = http_request("GET", f"{TARGET_URL}/cart.php?item=123", cookies=cookies)

# Access a different page that might interpret session variables differently
response = http_request("GET", f"{TARGET_URL}/checkout.php", cookies=cookies)

# Check if cart item is present (shouldn't be, if proper session isolation)
if "item=123" in response.text:
    results["vulnerabilities"].append("Session puzzling vulnerability detected")</code></pre>
        
        <h3>Target Endpoints</h3>
        <ul>
            <li>Cart: <code>/cart.php</code></li>
            <li>Checkout: <code>/checkout.php</code></li>
            <li>Admin: <code>/admin</code></li>
            <li>Profile: <code>/profile.php</code></li>
        </ul>
        
        <h3>Methodology</h3>
        <ol>
            <li>Set session variables in one context (e.g., cart page)</li>
            <li>Access different context (e.g., checkout page)</li>
            <li>Check if session variables carry over inappropriately</li>
            <li>Test across privilege levels if possible</li>
        </ol>
        
        <h3>Steps to Reproduce</h3>
        <ol>
            <li>Login to application</li>
            <li>Add item to cart (<code>/cart.php?item=123</code>)</li>
            <li>Navigate to checkout page</li>
            <li>Check if cart item appears in unexpected context</li>
            <li>If admin access available, test session variables across privilege levels</li>
        </ol>
        
        <h3>Test Result</h3>
        <div class="test-result passed">
            <strong>Status:</strong> No vulnerabilities found
        </div>
        
        <h3>Log Evidence</h3>
        <pre>{
  "error": "Login failed"
}</pre>
    </div>

</body>
</html>